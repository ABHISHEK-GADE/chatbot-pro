/* ===========================
   THEME
   =========================== */
:root{
  /* Colors */
  --bg:#0b1020;
  --panel:#111a2f;
  --panel-2:#0f172a;
  --text:#e6ecf3;
  --muted:#98a3b3;
  --border:#1f2a44;
  --accent:#7aa2ff;
  --accent-2:#4ade80;
  --danger:#ef4444;

  /* Effects */
  --shadow:0 8px 30px rgba(0,0,0,.35);

  /* Layout */
  --topbar-h:64px;

  /* Typography (fluid) */
  --fs-1:clamp(13px, .85vw + 10px, 15px);
  --fs-2:clamp(12px, .75vw + 8px, 14px);
  --fs-3:clamp(15px, 1vw + 12px, 18px);
}
:root[data-theme="light"]{
  --bg:#f5f7fb;
  --panel:#ffffff;
  --panel-2:#f8fafc;
  --text:#0f172a;
  --muted:#5b6472;
  --border:#e6e8ee;
  --accent:#3b82f6;
  --accent-2:#16a34a;
  --danger:#dc2626;
  --shadow:0 6px 20px rgba(0,0,0,.08);
}

/* ===========================
   BASE
   =========================== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:
    radial-gradient(1200px 800px at 10% -10%, rgba(124,58,237,.08), transparent 55%),
    radial-gradient(1000px 600px at 110% -20%, rgba(59,130,246,.08), transparent 45%),
    var(--bg);
  color:var(--text);
  font: var(--fs-1)/1.55 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
@media (prefers-reduced-motion: reduce){
  *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important; scroll-behavior:auto !important}
}

/* Utilities */
.sr-only{position:absolute; left:-9999px}
.hint{color:var(--muted); font-size:var(--fs-2)}
.link{color:var(--accent); cursor:pointer}
.row{display:flex; gap:10px; align-items:center}

/* Theme toggle icon swap */
#theme-toggle .theme-dark, #theme-toggle .theme-light{display:inline-block}
:root[data-theme="dark"]  #theme-toggle .theme-light{display:none}
:root[data-theme="light"] #theme-toggle .theme-dark{display:none}

/* Buttons & Inputs */
.btn{
  border:1px solid var(--border);
  background:linear-gradient(180deg, var(--panel), var(--panel-2));
  color:var(--text);
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
  transition:.18s ease;
  box-shadow:var(--shadow);
  font-size:var(--fs-1);
  min-height:38px;
}
.btn:hover{transform:translateY(-1px); border-color:var(--accent)}
.btn.primary{background:linear-gradient(180deg, var(--accent), #5e86ff); border-color:transparent; color:#fff}
.btn.ghost{background:transparent; box-shadow:none}
.btn.danger{border-color:var(--danger); color:var(--danger)}
.btn.xs{padding:6px 8px; border-radius:8px; font-size:12px; min-height:auto}

.select-wrap{position:relative}
.select{
  appearance:none;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  padding:10px 34px 10px 12px;
  border-radius:10px;
  font-size:var(--fs-1);
}
.select-wrap::after{
  content:"▾"; position:absolute; right:10px; top:50%; transform:translateY(-50%);
  pointer-events:none; color:var(--muted)
}

.input{
  width:100%;
  border:1px solid var(--border);
  background:var(--panel-2);
  color:var(--text);
  border-radius:12px;
  padding:10px 12px;
  outline:none;
  transition:.18s ease;
  font-size:var(--fs-1);
}
.input:focus{border-color:var(--accent); box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 20%, transparent)}

/* ===========================
   LAYOUT
   =========================== */
.topbar{
  position:sticky; top:0; z-index:10;
  display:flex; justify-content:space-between; align-items:center;
  padding:12px 16px;
  background:color-mix(in oklab, var(--panel) 85%, transparent);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(6px);
  min-height:var(--topbar-h);
}
.brand{display:flex; gap:10px; align-items:center}
.logo{width:36px; height:36px; display:grid; place-items:center; border-radius:10px; background:var(--panel-2)}
.brand-txt{display:flex; flex-direction:column; line-height:1.1}
.brand-txt .sub{color:var(--muted); font-size:var(--fs-2)}
.toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

/* Container grid */
.grid{
  display:grid;
  grid-template-columns: 1.4fr 1fr;
  gap:16px;
  padding:16px;
  height:calc(100vh - var(--topbar-h));
}

/* Panels */
.panel{
  background:color-mix(in oklab, var(--panel) 96%, transparent);
  border:1px solid var(--border);
  border-radius:16px;
  box-shadow:var(--shadow);
}

/* Chat column */
.chat-panel{
  display:flex; flex-direction:column;
  height:100%; min-height:0;
}
.chat-body{
  padding:16px;
  overflow:auto;
  display:flex; flex-direction:column; gap:12px;
  flex:1 1 auto; min-height:0;
  scroll-padding-bottom: 120px; /* keep last msg visible above keyboard on mobile */
}
.chat-panel > .chips{padding:0 16px 6px 16px}

/* Composer (sticky bottom of chat column) */
.composer{
  display:grid; grid-template-columns:auto 1fr auto; gap:10px;
  padding:12px calc(12px + env(safe-area-inset-right)) calc(12px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left));
  border-top:1px solid var(--border);
  background:color-mix(in oklab, var(--panel) 90%, transparent);
  border-radius:0 0 16px 16px;
  box-shadow:0 -6px 12px rgba(0,0,0,.08);
}

/* Side column */
.side-panel{padding:14px; display:flex; flex-direction:column; gap:16px}
.card{background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:14px}
.card-head{display:flex; justify-content:space-between; align-items:baseline; margin-bottom:8px}

/* ===========================
   CHAT BUBBLES
   =========================== */
.msg{display:flex}
.msg .bubble{
  width:100%;
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:14px;
  padding:10px 12px;
  position:relative;
  font-size: clamp(15px, .4vw + 14px, 16px);
}
.msg.user .bubble{
  background:color-mix(in oklab, var(--accent) 12%, var(--panel-2));
  border-color:color-mix(in oklab, var(--accent) 30%, var(--border));
}
.bubble-top{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px}
.author{display:flex; align-items:center; gap:8px; color:var(--muted); font-size:var(--fs-2)}
.avatar{width:22px; height:22px; border-radius:50%; background:var(--panel); border:1px solid var(--border)}
.msg.user .avatar{background:color-mix(in oklab, var(--accent) 35%, var(--panel))}
.tools{display:flex; gap:6px}
.content{white-space:pre-wrap}
.meta{margin-top:6px; color:var(--muted); font-size:var(--fs-2)}

.typing{display:inline-block; min-width:42px; letter-spacing:2px}
.typing::after{content:'• • •'; animation:blink 1s infinite steps(1,end)}
@keyframes blink{50%{opacity:.25}}

/* ===========================
   ANALYZE / UPLOAD
   =========================== */
.dropzone{
  position:relative;
  border:2px dashed var(--border);
  border-radius:14px;
  min-height:120px;
  display:grid; place-items:center;
  padding:10px; margin-bottom:8px;
  outline:none;
}
.dropzone:focus{border-color:var(--accent); box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 25%, transparent)}
.dropzone input[type=file]{position:absolute; inset:0; opacity:0; cursor:pointer}
.dz-inner{text-align:center; color:var(--muted)}
.dz-icon{font-size:26px; margin-bottom:6px}

/* Chips (Analyze + Chat composer) */
.chips{display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px}
.chip{
  display:flex; align-items:center; gap:6px;
  border:1px solid var(--border); background:var(--panel-2);
  color:var(--text); padding:6px 10px; border-radius:999px; font-size:12px
}
.chip .rm{border:none; background:transparent; color:var(--muted); cursor:pointer}

/* Converters */
.tabs{display:flex; gap:6px; flex-wrap:wrap; margin-bottom:8px}
.tab{
  border:1px solid var(--border);
  background:var(--panel-2);
  color:var(--text);
  padding:8px 10px;
  border-radius:10px;
  cursor:pointer;
  touch-action:manipulation;
}
.tab.active{border-color:var(--accent); outline:2px solid color-mix(in oklab, var(--accent) 35%, transparent)}
.tab-panels .panel-tab{display:none}
.tab-panels .panel-tab.active{display:block}

.file-row{
  position:relative;
  display:flex; align-items:center; gap:10px; justify-content:space-between;
  border:1px dashed var(--border); background:var(--panel-2);
  border-radius:12px; padding:10px;
}
.file-row input[type=file]{position:absolute; inset:0; opacity:0; width:100%; height:100%; cursor:pointer}
.file-row > span{margin-left:auto; pointer-events:none; color:var(--muted)}

/* ===========================
   TOAST
   =========================== */
.toast{
  position:fixed; bottom:calc(18px + env(safe-area-inset-bottom));
  left:50%; transform:translateX(-50%) translateY(20px);
  background:var(--panel);
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 14px; border-radius:12px;
  box-shadow:var(--shadow);
  opacity:0; pointer-events:none;
  transition:.25s ease;
}
.toast.show{opacity:1; transform:translateX(-50%) translateY(0)}

/* ===========================
   MARKDOWN / CODE
   =========================== */
.markdown{line-height:1.6}
.markdown h1,.markdown h2,.markdown h3{margin:10px 0 6px}
.markdown p{margin:8px 0}
.markdown ul,.markdown ol{padding-left:1.2rem; margin:8px 0}
.markdown blockquote{
  margin:10px 0; padding:8px 12px; border-left:3px solid var(--accent);
  background:color-mix(in oklab, var(--panel-2) 92%, transparent);
  color:var(--muted); border-radius:8px
}
.markdown table{width:100%; border-collapse:collapse; margin:10px 0}
.markdown th,.markdown td{border:1px solid var(--border); padding:6px 8px; text-align:left}
.markdown code{background:rgba(255,255,255,.06); padding:2px 6px; border-radius:6px}
.markdown pre{position:relative; overflow:auto; border-radius:12px}
.copy-code{
  position:absolute; top:8px; right:8px; z-index:1;
  border:1px solid var(--border); background:var(--panel); color:var(--text);
  padding:4px 8px; border-radius:8px; cursor:pointer; font-size:12px
}
.copy-code:hover{border-color:var(--accent)}

/* Previews for user attachments */
.preview-row{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px}
.preview{
  max-height:120px; border-radius:10px; border:1px solid var(--border);
  box-shadow:var(--shadow)
}
.file-pill{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px; font-size:12px;
  border:1px solid var(--border); background:var(--panel-2)
}

/* ===========================
   RESPONSIVE BREAKPOINTS
   =========================== */

/* >= 1440px (large desktops) */
@media (min-width:1440px){
  .grid{grid-template-columns: 1.6fr 1fr; gap:20px; padding:20px}
  .msg .bubble{font-size:16px}
}

/* 1024px–1439px (laptops/desktops) */
/* (defaults already tuned for this range) */

/* 768px–1023px (tablets) */
@media (max-width:1024px){
  .grid{grid-template-columns:1fr; height:auto; min-height:calc(100vh - var(--topbar-h))}
  .side-panel{order:2}
  .chat-panel{order:1; height:auto; min-height:60vh}
}

/* 480px–767px (phones) */
@media (max-width:767px){
  .topbar{padding:10px 12px}
  .toolbar{gap:8px}
  .grid{gap:12px; padding:12px}
  .chat-body{padding:12px}
  .composer{
    grid-template-columns:auto 1fr auto;
    gap:8px;
    padding:10px 10px calc(10px + env(safe-area-inset-bottom)) 10px;
    border-radius:0 0 12px 12px;
  }
  .btn{min-height:40px}
  .select{padding:8px 32px 8px 10px}
  .logo{width:32px; height:32px}
  .brand-txt .sub{font-size:12px}
  .msg .bubble{padding:10px}
  .markdown table{display:block; overflow:auto; -webkit-overflow-scrolling:touch}
  .preview{max-height:96px}
}

/* <= 360px (small phones) */
@media (max-width:360px){
  .toolbar .btn.ghost{display:none}
  .composer{grid-template-columns:1fr auto; }
  #attach{display:none}
}
